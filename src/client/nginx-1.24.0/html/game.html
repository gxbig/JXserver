<!DOCTYPE html>
<html lang="en" style="height:100%">
<head>
    <meta charset="UTF-8">
    <meta name="keywords"
          content="挣钱的游戏,金色传说,游戏,黄金,打工,荣耀,工会,联盟,挣钱,页游，好玩，挣钱游戏,收益,定义游戏，选择服务器">
    <title>选择服务区</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./layui/css/layui.css">
</head>
<body style="height:100%">
<div class="wrap" style="height:100%">
    <div style="margin-bottom: 5px;text-align: right;margin-right: 20px;font-size: 16px;padding-top: 5px">
       用户：<span id="email"></span>
        <button class="back layui-btn  layui-btn-xs">退出</button>
       服务器：<span id="selectServe"></span>
        <button class="hand-server layui-btn  layui-btn-xs">换区</button>
    </div>
    <iframe src="https://www.baidu.com/" style="width:100%;height: calc(100% - 34px);border: 0;display: block"
            id="gameIframe"></iframe>
</div>
</body>
<script src="./jquery-3.7.0.min.js"></script>
<script src="./cdn.staticfile.org_jquery-cookie_1.4.1_jquery.cookie.min.js"></script>
<script src="./layui/layui.js"></script>
<script>
    var url = "http://localhost:9000"
    var WSAddr = "http://127.0.0.1:3564"
    var loading = ''

    var time = ''

    function startLoading() {
        loading = layer.load('Loading...', {
            shade: [0.1, '#fff'] //0.1透明度的白色背景
        });
    }

    function closeLoading() {
        layer.close(loading);
    }

    var server = $.cookie("serverO")
    var serverMap = {}
    if ($.cookie("sessionId")) {
        getUser()
    } else {
        window.location.href = '/index.html'

    }
    //换区按钮
    $('.hand-server').on('click', function () {
        $.cookie("serverO", '')
        window.location.href = '/selectSever.html'
    })
    //退出
    $('.back').on('click', function () {
        $.removeCookie("serverO")
        $.removeCookie("sessionId")
        localStorage.clear()
        window.location.href = '/index.html'
    })

    //获取人员信息
    function getUser() {
        startLoading()
        $.ajax({
            url: url + '/getUser',
            method: 'get',
            error: function (err) {
                closeLoading()
                layer.msg('服务器异常！', {icon: 2});
            },
            success: function (res, status) {
                closeLoading()
                if (res.code === '200') {
                    $('#email').text(res.data.email)
                    //获取
                    window.localStorage.setItem('userInfo', JSON.stringify(res.data))
                    if (server) {
                        serverMap = JSON.parse(server) || {}
                        $('#selectServe').text(serverMap.serverName)
                    } else {
                        window.location.href = '/selectSever.html'
                    }
                } else if (res.code === '502') {

                } else {
                    layer.msg(res.data || res.message, {icon: 2});
                }
            },
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                "token": $.cookie("sessionId")
            },
            dataType: 'json'
        });
    }
</script>
</html>