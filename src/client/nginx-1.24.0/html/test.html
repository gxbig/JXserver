<head>
    <meta charset="utf-8" />
    <title>金色传说游戏</title>
    <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body>

<h3 style="color: cornflowerblue;">Golang语言社区（www.Golang.Ltd）</h3> 发送数据: <input type='text' id='name' value="Leaf测试">
<input type="submit" onclick="login()" />
<input type='text' id='getCode' value="18810994068@163.com">
<input type="submit" onclick="getCode()" />
<div>验证码 <span id="code"></span></div>
</body>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.7.0.min.js"></script>
<script>

function getCode(){

    let email = $('#getCode').val()
    $.ajax({
        url: 'http://127.0.0.1:9000/getCode',
        data: {email:email},
        method:'get',
        success: function(res,status){
            console.log(res)
            let codeArr =''
            if(res.code==='200'){


            }
            $('#code')[0].innerText =codeArr.join('')

        },
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        dataType: 'json'
    });

}




    var wsUri = "ws://127.0.0.1:3564/?{'new':3}";
    var json;
    function login() {
        var Data = {
            LoginName: "Golang.Ltd",
            LoginPW: "123456",
        };
        var json = {
            UserLogin:Data
        }
        var goServerJson = JSON.stringify(json);
        wsUri = wsUri;
        console.log(wsUri);
        doSend(goServerJson);
    }
    "{UrN".split('').map((item,index)=>{
        return String.fromCharCode(item.charCodeAt()-index-1)
    })

    var output;
    var websocket1;
    function init() {
        output = document.getElementById("output");
        testWebSocket();
    }
    function testWebSocket() {
        console.log(wsUri)
        websocket1 = new WebSocket(wsUri);
        websocket1.onopen = function(evt) {
            onOpen(evt)
        };
        websocket1.onclose = function(evt) {
            onClose(evt)
        };
        websocket1.onmessage = function(evt) {
            onMessage(evt)
        };
        websocket1.onerror = function(evt) {
            onError(evt)
        };
    }
    function onOpen(evt) {
        console.log("CONNECTED");
    }
    function onClose(evt) {
        console.log("DISCONNECTED");
    }

    function onError(evt) {
        console.log(evt.data);
    }
    function doSend(message) {
        console.log(message);
        websocket1.send(message);
    }
    function onMessage(evt) {
        console.log(evt);
        var filrReader = new FileReader();
        filrReader.onload = function() {
            var arrayBuffer = this.result;
            var decoder = new TextDecoder('utf-8')
            var json = JSON.parse(decoder.decode(new DataView(arrayBuffer)));
            console.log(json);
        };
        filrReader.readAsArrayBuffer(evt.data);
    };
    window.addEventListener("load", init, false);
</script>